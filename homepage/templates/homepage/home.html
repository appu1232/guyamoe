{% extends "layout.html" %}
{% load static %}
{% block head %}
	<title>Read the Kaguya-sama manga series | Guya.moe</title>
	<meta name="twitter:description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya." />
	<meta property="og:description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya." />
	<meta name="description" content="Read the Kaguya-sama: Love is War / Kaguya Wants to Be Confessed To manga and spin-off series. No ads. No bad reader. All guya.">
	<meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Read the Kaguya-sama manga series | Guya.moe" />
    <meta name="twitter:image" content="https://i.imgur.com/jBhT5LV.png" />
    <meta property="og:image" content="https://i.imgur.com/jBhT5LV.png">
    <meta property="og:url" content="/">
	<style>
	* {
		border: 0px solid red;
	}

	a:hover {
		text-decoration: none;
	}

	.img {
		height: auto;
		/* width: 20vw; */
		margin-bottom: 5vh;
		transition: 0.2s ease-in-out;
	}

	.img:hover {
		transform: scale(1.1, 1.1);
		opacity: 0.8;
		/* box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19); */
	}

	.sp-button {
		padding: 5%;
		background-color: #4b4b4b;
		color: white;
		transition: 0.2s ease-in-out;
	}

	.sp-button:hover {
		background-color: #e72e8c;
		transform: scale(1.1, 1.1);
		box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19);
	}

	.sp-button:focus {
		outline:0;
	}

	.sp-row-add {
		margin: 0;
	}

	.caption {
		margin-top: 2vh;
		word-wrap: wrap break-word;
	}

	img>p {
		width: inherit
	}

	.manga [class*="col-xs"] {
		margin-bottom: 15px;
	}
	body.h-100 {
		min-height: 100%;
		height: auto !important;
	}
	.manga h3 {
		color: #ddd;
		font-size: 1.5em;
		padding: 0 0.5em;
	}
		
	.tachi {
		margin-bottom: 3em;
		margin-right: 0;
		margin-left: 0;
	}

	.tachi > div {
		width: 100%;
	}

	.tachi img {
		height: 33px;
	}

	.tachi-plus {
		font-size: 1.5em;
		padding: 0 0.6em 0 0.4em;
	}

	.tachi .ecks {
		display: none;
	}

	@media only screen and (max-width: 760px) {
		.tachi {
			position: fixed;
			bottom: 0;
			width: 100%;
			bottom: 0;
			z-index: 1000;
			background: #232323;
			margin: 0;
			left: 0;
			padding: 1em 0 1.5em;
			border-top: 2px #777 solid;
		}

		.tachi > div.mb-5 {
			margin-bottom: 0 !important;
		}

		.tachi .ecks {
			display: block;
			position: absolute;
			font-size: 2em;
			color: white;
			padding: 0.25em 0.25em;
			box-sizing: content-box;
			width: 1em;
			line-height: 1em;
			height: 1em;
			right: 0;
			top: 0;
			cursor: pointer;
		}

	}

	#quote:hover {
		transform: scale(1.1);
		border: 1px solid #3A3F44;
	}
</style>

{% endblock %}

{% block body %}
<main role="main"> 
	<div class="manga-card" style="background-image: url(/static/img/bg_box_blur_smol.png);">
		<a class="picture" href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/"><picture>
			<source type="image/webp" srcset="{{ main_cover_webp }}" class="" alt="Kaguya-sama: Love is War">
  			<img src="{{ main_cover }}" class="" alt="Kaguya-sama: Love is War">
		</picture></a>
		<article>
			<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/"><h1>Kaguya-sama: Love is War</h1></a>
			<h2>Kaguya-sama Wants to Be Confessed To: The Geniuses' War of Love and Brains</h2>
			<h2>Kaguya-sama wa Kokurasetai: Tensai-tachi no Renai Zunousen</h2>
			<div class="manga-links">
				<span>
					<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/" class="manga-link full guya">Read the manga ›</a>
				</span>
				<span>
					<a href="#chapter_listing_exp" onclick="
						document.getElementById('chapter_listing').classList.add('vis');
						document.getElementById('chapter_listing_exp').classList.add('vis');
					" class="manga-link after-anime">Where to start after the anime ›</a><a href="//tachiyomi.org/extensions/#Guya" class="manga-link tachiyom">Tachiyomi plugin</a>
				</span>
			</div>
			<p>All’s fair when love is war!</p>
			<p>Two geniuses. Two brains. Two hearts. One battle.</p>
			<p>Kaguya Shinomiya and Miyuki Shirogane are the geniuses leading their prestigious academy’s student council, and inevitably they fell for each other. But they both are too prideful to be the first to confess, as that would be a loss in the competition of love! In the end, who will confess their love first?</p>
			<p class="yeet">I like to call this the Death Note of school romantic comedies. If Death Note ever made you laugh out loud (on purpose).</p>
			<div class="manga-links shill">
				<span>
					<a rel="noreferrer nofollow" href="https://www.viz.com/read/manga/kaguya-sama-love-is-war/all" class="manga-link viz">VIZ Media</a>
					<a rel="noreferrer nofollow" href="https://www.amazon.com/gp/bookseries/B0778N11ZV" class="manga-link ama">Amazon</a>
					<a rel="noreferrer nofollow" href="https://play.google.com/store/books/series?id=Cv3xGgAAABD65M&hl=en_US" class="manga-link gp">Google Play</a>
					<a rel="noreferrer nofollow" href="https://apps.qoo-app.com/en/app/6233" class="manga-link yj jp">Young Jump Weekly</a>
					<a rel="noreferrer nofollow" href="http://books.shueisha.co.jp/search/search.html?order=1&seriesid=37405" class="manga-link shu jp">Shueisha</a>
				</span>
			</div>
		</article>
		<div  id="chapter_listing_exp" class="chapter-listing-expander" onmousedown="
			event.stopImmediatePropagation();
			document.getElementById('chapter_listing').classList.toggle('vis');
			event.currentTarget.classList.toggle('vis');
		"><span>List of chapters</span></div>
		<table id="chapter_listing" class="chapter-listing hidden">
		</table>
	</div>
	<a href="/read/manga/We-Want-To-Talk-About-Kaguya/" class="manga-card smol" style="background-image: url({{ 4koma_cover_blur }})">
		<picture>
			<source type="image/webp" srcset="{{ 4koma_cover_webp }}" class="" alt="We Want to Talk About Kaguya">
  			<img src="{{ 4koma_cover }}" class="" alt="We Want to Talk About Kaguya">
		</picture>
		<article>
			<h2>We Want to Talk About Kaguya <span class="tag">Spin-off</span></h2>
			<p>A comedic tale of two delusional girls who have absolutely no idea what goes on in the Student Council room!</p>
		</article>
	</a>
	<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To-Official-Doujin/" class="manga-card smol" style="background-image: url({{ doujin_cover_blur }})">
		<picture>
			<source type="image/webp" srcset="{{ doujin_cover_webp }}" class="" alt="Kaguya Wants to Be Confessed To: Official Doujin">
  			<img src="{{ doujin_cover }}" class="" alt="Kaguya Wants to Be Confessed To: Official Doujin">
		</picture>
		<article>
			<h2>Kaguya Wants to Be Confessed To: Official Doujin <span class="tag">Spin-off</span></h2>
			<p>Official non-canon spin-off that contains stories featuring characters from the main manga in lewd and foreign settings.</p>
		</article>
	</a>
	<a href="//skythewood.blogspot.com/p/kaguya.html" target="_blank" class="manga-card smol" style="background-image: url({% static 'img/novelcover_blur.jpg' %})">
		<picture>
  			<img src="{% static 'img/novelcover.jpg' %}" class="" alt="Novel: The Seven Mysteries of Shuchiin Academy">
		</picture>
		<article>
			<h2>Novel: The Seven Mysteries of Shuchiin Academy <span class="tag">Spin-off</span></h2>
			<p>A light novel side story about the paranormal Legend of the Seven Mysteries of Shuchiin that the Student Council suddenly gets drawn into.</p>
		</article>
	</a>
	<a href="//kaguya-archive.tumblr.com/" target="_blank" class="manga-card smol" style="background-image: url({% static 'img/fanmade_media_blur.png' %})">
		<picture>
  			<img src="{% static 'img/fanmade_media.png' %}" class="" alt="Fanmade Media">
		</picture>
		<article>
			<h2>Fanmade Media</h2>
			<p>The archive website that contains translations and links to most of the fanmade media that is being produced on our Discord or elsewhere.</p>
		</article>
	</a>
</main>

<!-- <div class="manga container-fluid justify-content-center sp-row-add mt-3">
	<div class="row ">
		<div class="col d-flex justify-content-center mb-3">
			<img src="{% static '/img/logo_menu.png' %}" alt="Kaguya-sama: Love is War - Read Manga on Guya.moe">
		</div>
	</div>
	<div class="row d-flex justify-content-center mt-3" >
		<div class="col-lg-2 col-md-4 col-sm-12 col-xs-12">
			<div class="thumbnail img">
				<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/">
					<picture >
						<source type="image/webp" srcset="{{ main_cover_webp }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › Kaguya-sama: Love is War">
  						<img src="{{ main_cover }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › Kaguya-sama: Love is War">
					</picture>
					<div class="caption text-center">
						<h2>Kaguya-sama: Love is War</h2>
					</div>
				</a>
			</div>
		</div>
		<div class="col-lg-2 col-md-4 col-sm-12 col-xs-12">
			<div class="thumbnail img">
				<a href="/read/manga/We-Want-To-Talk-About-Kaguya/">
					<picture >
						<source type="image/webp" srcset="{{ 4koma_cover_webp }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › We Want to Talk About Kaguya">
  						<img src="{{ 4koma_cover }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › We Want to Talk About Kaguya">
					</picture>
					<div class="caption text-center">
						<h3>We Want to Talk About Kaguya</h3>
					</div>
				</a>
			</div>
		</div>
		<div class="col-lg-2 col-md-4 col-sm-12 col-xs-12">
			<div class="thumbnail img">
				<a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To-Official-Doujin/">
					<picture >
						<source type="image/webp" srcset="{{ doujin_cover_webp }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › Kaguya Wants to be Confessed to Official Doujin">
  						<img src="{{ doujin_cover }}" class="img-fluid mx-auto d-block" style="width: 80%" alt="Manga › Kaguya Wants to be Confessed to Official Doujin">
					</picture>
					<div class="caption text-center">
						<h3>Kaguya Wants to be Confessed to Official Doujin</h3>
					</div>
				</a>
			</div>
		</div>
		<div class="col-lg-2 col-md-4 col-sm-12 col-xs-12">
			<div class="thumbnail img">
				<a href="//skythewood.blogspot.com/p/kaguya.html" target="_blank">
					<img class="img-fluid mx-auto d-block" src="{% static 'img/novelcover.jpg' %}" style="width: 80%" alt="Novels › The Seven Mysteries of Shuchin Academy">
					<div class="caption text-center">
						<h3>The Seven Mysteries of Shuchin Academy (Novel)</h3>
					</div>
				</a>
			</div>
		</div>
		<div class="col-lg-2 col-md-4 col-sm-12 col-xs-12">
			<div class="thumbnail img">
				<a href="//kaguya-archive.tumblr.com/" target="_blank">
					<img class="img-fluid mx-auto d-block" src="{% static 'img/fanmade_media.png' %}" style="width: 80%" alt="Fanmade Media">
					<div class="caption text-center">
						<h3>Fanmade Media</h3>
					</div>
				</a>
			</div>
		</div>
	</div>
	<div class="row justify-content-center tachi">
		<div class="d-flex justify-content-center mb-2 tachi-title">
			Also available on Tachiyomi.
		</div>
		<div class="d-flex justify-content-center">
			<a class="tachi-tachi" target="_blank" href="//tachiyomi.org/">
				<img src="//raw.githubusercontent.com/inorichi/tachiyomi/master/.github/readme-images/app-icon.png" alt="Tachiyomi">
			</a>
			<span class="tachi-plus">+</span>
			<a class="tachi-guya" target="_blank" href="//tachiyomi.org/extensions/#Guya">
				<img src="{% static '/logo_small.png' %}" alt="Guya.moe Tachiyomi extension">
			</a>
			<span class="ecks" onclick="event.target.parentNode.parentNode.classList.add('hidden')">&times;</span>
		</div>
	</div>
</div> -->
</main>
<footer class="container-fluid footer mt-auto">
	<div class="row justify-content-between small" style="background-color:#2a2a2a;">
		<div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 float-left">
		</div>
		<div id="quote-block" class="col-lg-8 col-md-8 col-sm-8 col-xs-8 text-center">
		</div>
		<div class="col-lg-2 col-md-2 col-sm-2 col-xs-2 float-right">
			<img id="twintail-guya" class="img-fluid mx-auto d-block" style="height: 75px; width: 56px; float:right"
				src="{% static 'img/img_comics-bottom.png' %}">
		</div>
	</div>
	<!-- <a href="#" onclick="setTimeout(function () {  localStorage.setItem('reload', '1') }, 1);">reload stop</a><a href="#" onclick="setTimeout(function () {  localStorage.setItem('reload', '0')}, 1);">| start</a> -->
</footer>

<script>
	$(function(){
		let quoteNumb = Math.floor(Math.random() * 9) + 1;
		$("#quote-block").html(`<a target="_blank" href="//discord.gg/4WPqwSY"><img id="quote" class="img-fluid mx-auto d-block" src="{% static 'img/' %}quote${quoteNumb}.png" style="max-height: 70px"></a>`);
	});
	//setInterval(function () {if(localStorage.getItem('reload') != 1) location.reload(1); }, 4000);

	let msd = {{ main_series_data|safe }};

	var chapterList = doT.template(`
		<tbody>
		<tr class="chapter-row header">
			<th class="chapter-n"></th>
			<th class="chapter-name">Title</th>
			<th class="chapter-date" onclick="chapter_listing.children[1].reverseChildren(); event.target.classList.toggle('desc')">Upload date</th>
		</tr>
		</tbody>
		<tbody>
		((~it :value:index))
		<tr class="chapter-row ((? window.adapted.has(value[2]) ))adapted((?))((? +value[2] in s2_anime_map )) s2((?))">
			<td class="chapter-n">((=value[0]))</td>
			<td class="chapter-name"><a href="/read/manga/Kaguya-Wants-To-Be-Confessed-To/((=value[2]))/1">((=value[1]))</a>((? window.adapted.has(value[2]) ))<span data-anime="((=getAnimeString(+value[2]) ))">((? +value[2] in s2_anime_map ))Season 2!((??))Adapted((?))</span>((?))</td>
			<td class="chapter-date">((= value[4][0] ))-((= zpad(1+value[4][1]) ))-((= zpad(value[4][2]) ))</td>
		</tr>
		((~))
		<tbody>
		`)

var chaps_asc = msd.chapter_list.reverse();

	// Map goes from {chapter: [episode (1-indexed), part (0-indexed)]}
	s1_anime_map = {1:[1,0],5:[1,2],6:[2,2],7:[2,1],8:[3,1],9:[3,2],11:[2,0],12:[1,1],14:[3,0],16:[5,0],17:[4,0],18:[4,1],19:[4,2],20:[4,3],21:[5,2],23:[5,1],24:[6,0],25:[6,2],26:[7,0],27:[7,2],28:[6,1],29:[7,1],31:[8,1],33:[9,0],34:[9,1],35:[9,2],37:[10,0],38:[10,1],39:[8,0],40:[10,2],41:[11,2],42:[11,0],43:[11,1],44:[12,0],45:[12,1],46:[12,2],55:[8,2]}
	s2_anime_map = {30:[1,0],36:[5,2],48:[1,1],51:[1,3],52:[2,0],53:[2,1],54:[2,2],56:[3,0],57:[1,2],58:[4,0],59:[3,1],60:[3,2],61:[4,1],63:[5,0],64:[5,1],65:[4,2],66:[5,3],68:[],69:[],81:[],88:[]};
	adapted = new Set([...Object.keys(s1_anime_map), ...Object.keys(s2_anime_map)]);
	chapter_listing.innerHTML = chapterList(chaps_asc);

	function getAnimeString(num) {
		let map, season;
		if (num in s1_anime_map) {
			map = s1_anime_map;
			season = 1;
		} else if (num in s2_anime_map) {
			map = s2_anime_map;
			season = 2;
		} else {
			throw new Error("Map error, this shouldn't be thrown.");
		}
		let episode = map[num][0] || "TBA";
		let part = 1 + map[num][1] || "TBA";
		return `Season ${season}, Episode ${episode}, part ${part}`;
	}

	function zpad(n){
		if(n < 10) return '0'+n;
		return n;
	}


</script>
{% endblock %}
